import rutas from"./rutas.js";const CT=rutas.getCT(),CARTAGENA=["Cartagena","30200","30201","30202","30203","30204","30205","30280","30290","30300","30310","30319","30330","30350","30351","30353","30365","30366","30367","30368","30369","30370","30380","30381","30382","30383","30384","30385","30386","30387","30390","30391","30392","30393","30394","30395","30396","30397","30398","30399","30593","30594","30835","30868"],OPTIONS={fields:["address_component","geometry"],types:["geocode","establishment"],strictBounds:!1};var isLoaded;function fnGetComponent(e,r){e=e.address_components.find(e=>e.types.includes(r));return e&&e.short_name}const fnLocality=e=>fnGetComponent(e,"postal_code")||fnGetComponent(e,"locality"),fnCartagena=e=>CARTAGENA.includes(fnLocality(e)),fnMadrid=e=>"MD"==fnGetComponent(e,"administrative_area_level_1"),fnBarcelona=e=>"B"==fnGetComponent(e,"administrative_area_level_2"),fnCountry=e=>{var r=fnGetComponent(e,"country");return r==CT.pais&&fnMadrid(e)?"ES-MD":r==CT.pais&&fnBarcelona(e)?"ES-BA":r};window.initMap=()=>{var t,a,e=document.getElementById("add-ruta");if(e){const r=new google.maps.places.Autocomplete(document.getElementById("origen"),OPTIONS),n=new google.maps.places.Autocomplete(document.getElementById("destino"),OPTIONS),o=new google.maps.DistanceMatrixService;r.addListener("place_changed",function(){t=r.getPlace()}),n.addListener("place_changed",function(){a=n.getPlace()}),e.onclick=e=>{e.preventDefault();let r=null;if(!t&&rutas.empty()?((r=new google.maps.LatLng(CT.lat,CT.lng)).pais=CT.pais,r.mask=CT.mask):t?((r=t.geometry.location).pais=fnCountry(t),r.mask=fnCartagena(t)?4:0):0<rutas.size()&&(e=rutas.last(),(r=new google.maps.LatLng(e.lat2,e.lng2)).pais=e.pais2,r.mask=e.mask),dom.closeAlerts().intval("#desp","errTransporte","errRequired").required("#f2","errDate","errRequired").required("#h2","errDate").required("#f1","errDate","errRequired").required("#h1","errDate").required("#destino","errDestino","errRequired").required("#origen","errOrigen","errRequired"),a||dom.addError("#destino","errDestino","errRequired"),r||dom.addError("#origen","errOrigen","errRequired"),dom.isError())return!1;const s=i18n.toData();return s.dt1=sb.toIsoDate(s.f1,s.h1),s.dt2=sb.toIsoDate(s.f2,s.h2),s.lat1=r.lat(),s.lng1=r.lng(),s.pais1=r.pais,s.lat2=a.geometry.location.lat(),s.lng2=a.geometry.location.lng(),s.pais2=fnCountry(a),s.mask=4&r.mask&&fnCartagena(a)?4:0,s.origen==s.destino?!dom.addError("#origen","errItinerarioCiudad","errRequired"):!!rutas.valid(s)&&("1"==s.desp?o.getDistanceMatrix({origins:[r],destinations:[a.geometry.location],travelMode:"DRIVING"},function(e,r){if("OK"!==r)return!dom.addError("#origen","The calculated distance fails due to "+r);for(var t=e.originAddresses,a=0;a<t.length;a++)for(var n=e.rows[a].elements,o=0;o<n.length;o++){var i=n[o];s.km2=i.distance.value/1e3}rutas.add(s,s.km2)}):rutas.add(s,null),void(t=a=null))}}return!0};export default()=>{var e;return isLoaded?window.initMap():((e=document.createElement("script")).src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIlqxZkVg9GyjzyNzC0rrZiuY6iPLzTZI&libraries=places&callback=initMap",e.async=!0,e.defer=!0,document.head.appendChild(e),isLoaded=!0)};