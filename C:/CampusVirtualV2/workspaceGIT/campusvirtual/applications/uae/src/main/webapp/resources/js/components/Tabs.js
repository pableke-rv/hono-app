import alerts from"./Alerts.js";import coll from"./CollectionHTML.js";const fnTrue=()=>!0,FOCUSABLED="[tabindex]:not([type=hidden],[readonly],[disabled])",TAB_CLASS="tab-content",ACTIVE_CLASS="active";function Tabs(){const a=this,s={};let r,o,l;const i=(t,e)=>(s[t]=e,a),e=t=>t.classList.contains(ACTIVE_CLASS),n=e=>r.findIndex(t=>t.id=="tab-"+e),h=()=>r.findIndex(e),c=(t,e)=>{r.forEach(t=>t.classList.remove(ACTIVE_CLASS)),t.classList.add(ACTIVE_CLASS),o=e??h();e=t;return(e=e.querySelectorAll(FOCUSABLED).find(t=>t.isVisible()))&&e.focus(),a},b=(this.getCurrent=()=>r[o],this.getTab=e=>r.find(t=>t.id=="tab-"+e),this.setActive=t=>c(a.getTab(t)),this.isActive=t=>e(a.getTab(t)),this.render=(e,s)=>(r.forEach(t=>t.querySelectorAll(e).render(s)),a),(t,e)=>{return(s[t+"-"+e.id]||fnTrue)(e,a)});function f(t){t=t<0?0:Math.min(t,l);var e=r[t];return b("show",e)&&(o<t&&(e.dataset.back=Math.max(o<0?t-1:o,0)),alerts.closeAlerts(),b("init",e),delete s["init-"+e.id],b("view",e),c(e,t)),alerts.working().top(),a}this.setShowEvent=(t,e)=>i("show-tab-"+t,e),this.setInitEvent=(t,e)=>i("init-tab-"+t,e),this.setViewEvent=(t,e)=>i("view-tab-"+t,e),this.showOk=t=>(alerts.showOk(t),a),this.showInfo=t=>(alerts.showInfo(t),a),this.showWarn=t=>(alerts.showWarn(t),a),this.showError=t=>(alerts.showError(t),a),this.showAlerts=t=>(alerts.showAlerts(t),a),this.showTab=t=>f(n(t)),this.lastTab=()=>f(l),this.backTab=t=>f(globalThis.isset(t)?n(t):+(r[o].dataset.back??o-1)),this.prevTab=()=>a.backTab,this.nextTab=()=>f(o+1),this.toggle=t=>{const e=t.querySelector(t.dataset.icon||"i");return document.querySelectorAll(t.dataset.target||".info-"+t.id).toggle(),coll.split(t.dataset.toggle," ").forEach(t=>e.toggle(t)),a},this.setActions=t=>(t.querySelectorAll("[href='#back-tab'],[href='#prev-tab']").forEach(t=>{t.onclick=t=>{t.preventDefault(),a.backTab()}}),t.querySelectorAll("[href='#next-tab']").forEach(t=>{t.onclick=t=>{t.preventDefault(),a.nextTab()}}),t.querySelectorAll("[href^='#tab-']").forEach(t=>{const e=t.href.substring(t.href.lastIndexOf("-")+1);t.onclick=t=>{t.preventDefault(),a.showTab(e)}}),t.querySelectorAll("[href='#last-tab']").forEach(t=>{t.onclick=t=>{t.preventDefault(),a.lastTab()}}),t.querySelectorAll("[href='#toggle']").forEach(e=>{e.onclick=t=>{t.preventDefault(),a.toggle(e)}}),a),this.load=t=>(r=t.getElementsByClassName(TAB_CLASS),o=h(),l=r.length-1,a.setActions(t)),a.load(document),window.showTab=(t,e,s,r)=>{return t&&"success"==e?((s=!(e=coll.parse(s.msgs))?.msgError)&&(globalThis.isset(r)?a.showTab(r):a.nextTab()),alerts.showAlerts(e),s):!alerts.showError(t||"Error 500: Internal server error.").working()}}export default new Tabs;