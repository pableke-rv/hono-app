import api from"./Api.js";import alerts from"./Alerts.js";import coll from"./CollectionHTML.js";import tabs from"./Tabs.js";function Navigation(){const a=this,e={},i=document.body.children.findOne("main");this.ready=coll.ready,this.isStatic=t=>t.endsWith(".html"),this.isDynamic=t=>!a.isStatic(t),this.redirect=t=>{window.location.href=t},this.getScript=t=>e[t],this.setScript=(t,i)=>(e[t]=i,a),this.runScript=(t,i)=>(i(),a.setScript(t,i)),this.setClick=(t,i)=>(t.querySelectorAll(i=i||"a.load-main").setClick((t,i)=>{api.init().text(i.href).then(a.setMain),t.preventDefault()}),a),this.setMain=t=>t?(i.innerHTML=t,i.querySelectorAll("script[id]").forEach(i=>{var t=a.getScript(i.id);if(t)return t();import(i.src).then(t=>{a.runScript(i.id,t.default)}).catch(t=>{alerts.showError(t)}),i.parentNode.removeChild(i)}),alerts.top(),tabs.load(i),a.setClick(i)):a,document.startViewTransition&&window.navigation.addEventListener("navigate",t=>{const i=new URL(t.destination.url);if(!i.searchParams.get("nav")&&!a.isDynamic(i.pathname)){if(location.pathname==i.pathname)return t.preventDefault();if(location.origin==i.origin){const e=/<main[^>]*>([\s\S]*)<\/main>/im,n=t=>{document.startViewTransition(()=>a.setMain(t.match(e)[1]))};t.intercept({handler:()=>api.init().text(i.href).then(n)})}}})}export default new Navigation;