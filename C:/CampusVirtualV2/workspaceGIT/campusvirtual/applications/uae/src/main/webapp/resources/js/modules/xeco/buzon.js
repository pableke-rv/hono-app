import Form from"../../components/Form.js";import tabs from"../../components/Tabs.js";import modals from"../../components/Modals.js";import pf from"../../components/Primefaces.js";import buzon from"../../model/xeco/Buzon.js";pf.ready(()=>{const a=new Form("#xeco-buzon"),e=a.getInput("#tipo");function t(){var o=buzon.setTipoPago(+e.value).isIsu(s.getCurrentItem());buzon.setJustPagoRequired(buzon.isPagoCesionario()&&o),a.setVisible("#file-jp",buzon.isJustPagoRequired()).text(".filename","").setVisible("#check-jp",buzon.isPagoCesionario()&&!o)}function o(){buzon.setTipoPago(+e.value),buzon.setJustPagoRequired(buzon.isPagoCesionario()),a.hide("#check-jp").text(".filename","").setVisible("#file-jp",buzon.isJustPagoRequired())}function r(o,e){return pf.fetch(o,{org:e.org,cod:e.oCod,ut:e.grp,m:e.mask}),n.reset()}const n=new Form("#xeco-organicas"),s=n.setTable("#organcias",{rowEmptyTable:buzon.lastRow(1),onRender:buzon.row,onFooter:buzon.tfoot,onRemove:o=>r("remove",o)});s.set("#anclar",o=>r("anclar",o)),s.set("#desanclar",o=>r("desanclar",o)),s.set("#modal",o=>modals.open("#modal-ut")),s.set("#report",o=>r("report",o)),s.set("#buzon",o=>{a.setval("#buzon-id-org",o.org).setval("#buzon-cod-org",o.oCod).setval("#tramit-all",o.grp).readonly(!0,"#tramit-all").text("#org-desc",o.oCod+" / "+o.oDesc),(e.onchange=t)(),tabs.showTab(1)}),s.set("#buzon-otros",()=>{a.setval("#buzon-id-org").setval("#buzon-cod-org").readonly(!1,"#tramit-all").text("#org-desc",s.html("#otras")),(e.onchange=o)(),tabs.showTab(1)}),s.render(JSON.read(n.html("#organcias-json"))),n.setAcItems("#organica",o=>window.findOrganica(pf.param("cod",o)),o=>window.setUnidadesTramit(pf.param("org",o.value))),window.isOrganica=()=>n.isValid(buzon.isValidOrganica),pf.uploads(a.querySelectorAll("[href='#open-upload']")),tabs.setShowEvent(2,o=>{var e=a.querySelectorAll(".filename").filter(o=>o.innerHTML),t=e.map(o=>o.innerHTML).join(", ");return t?buzon.isJustPagoRequired()&&e.length<2?!a.showError("Debe seleccionar Justificante de pago."):a.text("#ut-desc",a.getOptionText("#tramit-all")).text("#file-name",t):!a.showError("Debe seleccionar una factura.")}),window.loadUnidadesTramit=(o,e,t)=>{pf.showAlerts(o,e,t)&&(o=n.getInput("#tramit"),n.setVisible("#unidades-tramit",1<JSON.size(o.children)))},window.loadBuzon=(o,e,t)=>{pf.showAlerts(o,e,t)&&((o=JSON.read(t.data))&&s.render(o),n.reset().showOk("saveOk"))}});