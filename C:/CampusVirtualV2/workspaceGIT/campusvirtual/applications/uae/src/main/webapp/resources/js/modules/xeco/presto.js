import alerts from"../../components/Alerts.js";import Form from"../../components/Form.js";import tabs from"../../components/Tabs.js";import pf from"../../components/Primefaces.js";import i18n from"../../i18n/langs.js";import presto from"../../model/xeco/Presto.js";import uxxiec from"../../model/xeco/Solicitud.js";import solicitudes from"./xeco.js";document.addEventListener("DOMContentLoaded",()=>{const t=presto.getPartida(),s=presto.getPartidas(),a=new Form("#xeco-030"),o=a.setAcItems("#acOrg030",e=>window.rcFindOrg030(pf.param("term",e)),e=>a.setval("#idEco030",e.imp)),i=(a.setClick("#save-030",e=>{t.setData(d.getCurrentItem()),a.isValid(t.validate030)&&(i.saveTable("#partidas-json",d),tabs.backTab().showOk("Datos del documento 030 asociados correctamente."))}),new Form("#xeco-presto"));solicitudes(presto,i),tabs.setActive(uxxiec.isUxxiec()?0:2);var e="Seleccione una económica";const r=pf.datalist(i,"#idEcoDec","#idEcoDecPF",{emptyOption:e,onChange:e=>i.setval("#cd",e.imp),onReset:()=>i.setval("#impDec").setval("#cd")}),n=pf.datalist(i,"#idEcoInc","#idEcoIncPF",{emptyOption:e}),d=(pf.uploads(i.querySelectorAll("[href='#open-upload']")),i.setTable("#partidas-inc",{msgEmptyTable:"No existen partidas asociadas a la solicitud",beforeRender:e=>{e.imp=0},onHeader:t.thead,onRender:t.row,onFooter:t.tfoot,afterRender:e=>{s.setData(d);e=0<e.size;i.readonly(e,"#ejDec").readonly(e||presto.isDisableEjInc(),"#ejInc").setVisible(".show-partida-inc",presto.showPartidasInc())},"#doc030":e=>{e.ej030=e.ej,e.imp080=i18n.isoFloat(e.imp);var t=presto.isDisabled()&&!presto.isFirmable();a.render(".info-080",e).setData(e).setVisible("#memo-030",presto.getMemo()).readonly(t).setVisible("#save-030",!t).text("#memo-030",presto.getMemo()),o.setValue(e.idOrg030,e.o030+" - "+e.dOrg030),tabs.showTab(3)}}));const c=i.setAcItems("#acOrgDec",e=>window.rcFindOrgDec(pf.param("term",e)),e=>{presto.isAutoLoadInc()&&d.render(),i.setval("#faDec",1&e.int),pf.sendId("rcEcoDec",e.value)},()=>{presto.isAutoLoadInc()&&d.render(),i.setval("#faDec"),pf.sendId("rcEcoDec")}),l=i.setAcItems("#acOrgInc",e=>window.rcFindOrgInc(pf.param("term",e)),e=>{i.setval("#faInc",1&e.int),pf.sendId("rcEcoInc",e.value)},()=>{i.setval("#faInc").setval("#impInc"),pf.sendId("rcEcoInc")}),p=(i.onChangeInput("#idEcoDec",e=>{presto.isL83()?i.click("#autoload-l83"):presto.isAnt()&&i.click("#autoload-ant")}),i.onChangeInput("#impDec",e=>{var t=d.getData();presto.isAutoLoadImp()&&t.length&&(t[0].imp=i.getValue(e.target),d.render(t))}),i.onChangeInput("#urgente",e=>i.setVisible(".grp-urgente","2"==e.target.value)).onChangeInput("#ejDec",e=>{i.setval("#ejInc",e.target.value),c.reset()}).onChangeInput("#ejInc",l.reset),e=>{t.isAfectada(e?.int)&&(presto.isTcr()||presto.isFce())&&i.showInfo("La orgánica seleccionada es afectada, por lo que su solicitud solo se aceptará para determinado tipo de operaciones."),alerts.working()}),m=(e,t)=>{e.imp=t||0,d.render([e]),i.setval("#impDec",e.imp)},u=(window.autoloadL83=(e,t,a)=>{a=JSON.read(a?.data);a?m(a,r.getItem(0).imp):c.isItem()&&i.showError("Aplicación AIP no encontrada en el sistema.")},window.autoloadAnt=(e,t,a)=>{a=JSON.read(a?.data);a?m(a,Math.max(0,a.ih)):c.isItem()&&i.showError("No se ha encontrado el anticipo en el sistema.")},e=>{r.setItems(JSON.read(e?.economicas))});window.loadEconomicasDec=(e,t,a)=>{u(a),presto.isL83()?window.autoloadL83(e,t,a):presto.isAnt()&&window.autoloadAnt(e,t,a),p(c.getCurrentItem())},window.loadEconomicasInc=(e,t,a)=>{n.setItems(JSON.read(a?.data)),p(l.getCurrentItem())},window.fnAddPartidaInc=()=>i.isValid(t.validate),window.loadPartidaInc=(e,t,a)=>{a=JSON.read(a.data);if(!s.setData(d).validatePartida(a))return i.setError("#acOrgInc","¡Partida ya asociada a la solicitud!","notAllowed");a.imp030=a.imp=i.valueOf("#impInc"),d.add(a),i.setVisible(".link-adjunto",presto.getAdjunto()),l.reload()},window.viewPresto=(e,t,a)=>{if(!pf.showAlerts(e,t,a))return!1;e=JSON.read(a.presto);presto.setData(e),n.reset(),i.setData(e).readonly(presto.isDisabled()).readonly(!presto.isEditableUae(),".editable-uae").setVisible(".insert-only",presto.isEditable()).setVisible(".update-only",presto.isDisabled()).setVisible(".firmable-only",presto.isFirmable()).setVisible(".rechazable-only",presto.isRechazable()).setVisible(".show-partida-dec",presto.isPartidaDec()).setVisible(".show-partida-inc",presto.showPartidasInc()).setVisible(".show-imp-cd",presto.isImpCd()).setVisible(".show-memoria",!presto.isL83()).setVisible(".grp-urgente",presto.isUrgente()).setVisible(".show-subtipo",uxxiec.isUae()&&presto.isGcr()).setVisible(".is-fce",presto.isFce()).setVisible(".link-adjunto",presto.getAdjunto()).text(".filename",""),u(a),d.render(JSON.read(a.data)),c.setValue(e.idOrgDec,e.orgDec+" - "+e.dOrgDec),tabs.render(".load-data",e).showTab(1)},window.fnSend=()=>(s.setData(d),!!i.isValid(presto.validate)&&(s.setPrincipal(),i.saveTable("#partidas-json",d),i18n.confirm("msgSend"))&&i.loading())});