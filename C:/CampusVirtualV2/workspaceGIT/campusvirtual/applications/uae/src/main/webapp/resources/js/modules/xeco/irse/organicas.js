import perfil from"./perfil.js";import rutas from"./rutas.js";import dietas from"./dietas.js";import imputacion from"./imputacion.js";function IrseOrganicas(){const e=this,a={imp1:0,totManutenciones:0,totPernoctas:0,totTransporte:0,totAc:0},s={remove:"msgDelOrg",imp1:i18n.isoFloat,subtipo:t=>i18n.arrval("tiposMultiorganica",t)};let n;this.getImpTransporte=function(){return a.totTransporte},this.getImpPernoctas=function(){return a.totPernoctas},this.getImpDietas=function(){return a.totManutenciones},this.getImpAc=function(){return a.totAc},this.getTotTransporte=function(){return rutas.getImpKm()+IRSE.impTransporte+IRSE.impExtraTrans},this.getTotPernoctas=function(){return IRSE.minPernoctas+IRSE.impExtraAloja},this.getTotDietas=function(){return dietas.getImpPercibir()+IRSE.impExtraDietas},this.getImpBruto=()=>e.getTotTransporte()+e.getTotPernoctas()+e.getTotDietas()+IRSE.totAc,this.getImpTotal=()=>e.getImpBruto()-IRSE.irpf,this.validAll=function(){return nb.eq01(a.totManutenciones,e.getTotDietas())?nb.eq01(a.totPernoctas,e.getTotPernoctas())?nb.eq01(a.totTransporte,e.getTotTransporte())?nb.eq01(a.totAc,IRSE.totAc)?!!nb.eq01(a.imp1,e.getImpBruto())||!dom.addError("#imp1-org","errImpBruto"):!dom.addError("#imp1-org","errMaxAsist"):!dom.addError("#imp1-org","errMaxTrans"):!dom.addError("#imp1-org","errMaxAloja"):!dom.addError("#imp1-org","errMaxDietas")},this.add=function(){if(dom.closeAlerts().intval("#tipo-org","errTipo","errRequired").fk("#organicas","errOrganicas","errRequired").gt0("#imp1-org","errGt0","errRequired"),dom.isOk()){var t=i18n.toData();if("1"==t.subtipo&&t.imp1+a.totManutenciones>e.getTotDietas())return!dom.addError("#imp1-org","errMaxDietas");if("2"==t.subtipo&&t.imp1+a.totPernoctas>e.getTotPernoctas())return!dom.addError("#imp1-org","errMaxAloja");if("3"==t.subtipo&&t.imp1+a.totTransporte>e.getTotTransporte())return!dom.addError("#imp1-org","errMaxTrans");if("4"==t.subtipo&&t.imp1+a.totAc>IRSE.totAc)return!dom.addError("#imp1-org","errMaxAsist");if(t.imp1+a.imp1>IRSE.bruto)return!dom.addError("#imp1-org","errImpBruto");t.cod=dom.getOptText("#organicas");var r=perfil.getOrganica(+t.num);t.nombre=imputacion.get(t.subtipo,r),t.desc=r&&r.dOrg,n.push(t),dom.table("#multiorganicas",n,a,s)}return!1},this.build=function(){var t,r,o,i;return perfil.empty()?!dom.addError("#imp1-org","errImputacion"):(perfil.isMultiorganica()||(ab.reset(n),r={num:(t=perfil.getOrganicas()[0]).id,cod:t.o,desc:t.dOrg},0<(i=e.getTotDietas())&&((o=Object.assign({subtipo:1},r)).nombre=imputacion.get(o.subtipo,t),o.imp1=i,n.push(o)),0<(i=e.getTotPernoctas())&&((o=Object.assign({subtipo:2},r)).nombre=imputacion.get(o.subtipo,t),o.imp1=i,n.push(o)),0<(i=e.getTotTransporte())&&((o=Object.assign({subtipo:3},r)).nombre=imputacion.get(o.subtipo,t),o.imp1=i,n.push(o)),0<IRSE.totAc&&((i=Object.assign({subtipo:4},r)).nombre=imputacion.get(i.subtipo,t),i.imp1=IRSE.totAc,n.push(i)),dom.table("#multiorganicas",n,a,s)),e.validAll())},this.init=()=>(n=ab.parse(dom.getText("#gastos-org"))||[],dom.onRenderTable("#multiorganicas",t=>{a.imp1=0,a.totManutenciones=a.totPernoctas=0,a.totTransporte=a.totAc=0,n.forEach(t=>{a.imp1+=t.imp1,a.totManutenciones+="1"==t.subtipo?t.imp1:0,a.totPernoctas+="2"==t.subtipo?t.imp1:0,a.totTransporte+="3"==t.subtipo?t.imp1:0,a.totAc+="4"==t.subtipo?t.imp1:0}),dom.setValue("#imp-org",JSON.stringify(n)).setValue("#imp1-org","").setFocus("#tipo-org")}),e)}export default new IrseOrganicas;