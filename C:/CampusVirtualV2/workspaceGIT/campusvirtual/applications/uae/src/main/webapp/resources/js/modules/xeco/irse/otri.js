import Form from"../../../components/Form.js";import tabs from"../../../components/Tabs.js";import pf from"../../../components/Primefaces.js";import excel from"../../../components/Excel.js";import i18n from"../../../i18n/langs.js";import rutas from"./rutas.js";function Otri(){const c=this;this.colaboracion=(e,o)=>(window.fnPaso3=()=>dom.closeAlerts().required("#justifi","errJustifiSubv","errRequired").isOk()&&dom.loading(),c),this.congreso=(e,o)=>{rutas.update(),o.querySelectorAll(".rutas-vp").forEach(e=>e.classList.toggle("hide",rutas.getNumRutasVp()<1));const t=e.getInput("#congreso"),i=e.getInput("#fIniCong"),r=e.getInput("#fFinCong"),n=e.querySelector(".justifi-congreso");function s(){var e=dt.toDate(i.value),o=dt.toDate(r.value);return dt.addDate(e,-1).trunc(e).addDate(o,2).trunc(o),e&&dt.lt(rutas.start(),e)||o&&dt.lt(o,rutas.end())}function a(){i.setAttribute("max",r.value),r.setAttribute("min",i.value),dom.toggleHide(n,!s())}function u(){dom.toggleHide(".grp-congreso","0"==t.value),0<+t.value?a():dom.hide(n)}return dom.onBlurInput(i,a).onBlurInput(r,a).onChangeInput(t,u),u(),window.fnPaso3=function(){return dom.closeAlerts().required("#justifi","errJustifiSubv","errRequired").required("#entidad-origen","errEntidadOrigen","errRequired"),rutas.getNumRutasVp()&&dom.required("#justifiVp","errJustifiVp","errRequired"),s()&&dom.required("#justifiCong","errCongreso","errRequired"),"4"==t.value&&dom.required("#impInsc","errNumber","errRequired"),dom.isOk()&&dom.loading()},c}}function fnViewIsu(){new Form("#xeco-isu").setAcItems("#acIrse",e=>pf.sendTerm("rcSolicitudesIrse",e),e=>pf.sendId("rcLinkIrse",e.value))}window.viewIsu=(e,o,t)=>{showAlerts(e,o,t)&&fnViewIsu()},tabs.setInitEvent(16,e=>{new Form("#xeco-filtro-isu").setAutocomplete("#organica-isu",{minLength:4,source:e=>pf.sendTerm("rcFindOrg",e),render:e=>e.o+" - "+e.dOrg,select:e=>e.id})}),tabs.setViewEvent(17,fnViewIsu),window.xlsx=(e,o,t)=>{if(!showAlerts(e,o,t))return!1;e=JSON.parse(t.data);excel.json(e,{keys:["ej","cod","jg","fact","nif","ter","impJg","fJg","descJg","nifInt","int","vinc","gasto","act","proy","dest","pais","itinerario","start","end","loc","vp","km","impKm","fCong1","fCong2","impTrans","noches","impPern","dias","impDietas","impTotal","taxis"],titles:["Ej.","ID","Nº JG.","Nº Factura","NIF Tercero","Nombre del Tercero","Imp. Total","F. Emisión","Descripción","NIF Interesado","Nombre del Interesado","Vinculación","Tipo de Gasto","Actividad","Relación con el Proyecto","Destino Principal","Pais","Itinerario","F. Inicio","F. Fin","Locomoción","Vehiculo Propio","Km.","Imp./Km.","F. Inicio Congreso","F. Fin Congreso","Tot. Locomoción","Nº Noches","Tot. Alojamiento","Nº Días","Tot. Manutención","Total","Taxi"],columns:{km:e=>{e.z="#,##0.00"},impKm:e=>{e.z="#,##0.00"},fCong1:(e,o)=>{e.v=i18n.isoDate(o.fCong1)},fCong2:(e,o)=>{e.v=i18n.isoDate(o.fCong2)},impTrans:e=>{e.z="#,##0.00"},impPern:e=>{e.z="#,##0.00"},impDietas:e=>{e.z="#,##0.00"},impTotal:e=>{e.z="#,##0.00"}}})};export default new Otri;