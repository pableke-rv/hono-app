import Msgs from"./msgs.js";import{BankNames,IbanCodeLengths}from"../data/banks.js";function fnSize(r,t,e,s,i){return e?(e.length>s&&r.setError(i||"errMaxlength",t),!0):!r.setError("errRequired",t)}function fnDate(r,t,e,s){return e?/^\d{4}-[01]\d-[0-3]\d/.test(e)||!r.setError(s||"errDate",t):!r.setError("errRequired",t)}export default class Validators extends Msgs{static#sysdate=(new Date).toISOString();constructor(r){super(r)}gt0(r,t,e){return t&&0<t?this:this.setError(e||"errGt0",r)}ge0(r,t,e){return!t||0<t?this:this.setError(e||"errGt0",r)}max(r,t,e,s){return!t||t.length<=e?this:this.setError(s||"errMaxlength",r)}isKey(r,t,e){return t?0<t?this:this.setError(e||"notFound",r):this.setError("errRequired",r)}size(r,t,e,s){return fnSize(this,r,t,e??1e3,s),this}size20(r,t,e){return fnSize(this,r,t,20,e),this}size50(r,t,e){return fnSize(this,r,t,50,e),this}size100(r,t,e){return fnSize(this,r,t,100,e),this}size200(r,t,e){return fnSize(this,r,t,200,e),this}size250(r,t,e){return fnSize(this,r,t,250,e),this}size500(r,t,e){return fnSize(this,r,t,500,e),this}isEmail(r,t,e){return!fnSize(this,r,t,200)||/\w+[^\s@]+@[^\s@]+\.[^\s@]+/.test(t)?this:this.setError(e||"errCorreo",r)}isLogin(r,t,e){return fnSize(this,r,t,200)?t.length<8?this.setError("errMinlength8",r):/^[\w#@&°!§%;:=\^\/\(\)\?\*\+\~\.\,\-\$]{6,}$/.test(t)?this:this.setError(e||"errFormat",r):this}word(r,t,e){return!fnSize(this,r,t,50)||/\w+/.test(t)?this:this.setError(e||"errFormat",r)}words(r,t,e){return!fnSize(this,r,t,200)||/^\w+(,\w+)*$/.test(t)?this:this.setError(e||"errFormat",r)}digits(r,t,e){return!fnSize(this,r,t,20)||/^[1-9]\d*$/.test(t)?this:this.setError(e||"errFormat",r)}numbers(r,t,e){return!fnSize(this,r,t,200)||/^\d+(,\d+)*$/.test(t)?this:this.setError(e||"errFormat",r)}isDate(r,t,e){return fnDate(this,r,t,e),this}isTime(r,t,e){return t?/[0-2]\d:[0-5]\d:[0-5]\d[\.\d{1,3}]?$/.test(t)?this:this.setError(e||"errDate",r):this.setError("errRequired",r)}isDateTime(r,t,e){return t?/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d{1,3}Z$/.test(t)?this:this.setError(e||"errDate",r):this.setError("errRequired",r)}leToday(r,t,e){return fnDate(this,r,t)&&t.substring(0,10)>Validators.#sysdate.substring(0,10)?this.setError(e||"errDateLe",r):this}geToday(r,t,e){return fnDate(this,r,t)&&t.substring(0,10)<Validators.#sysdate.substring(0,10)?this.setError(e||"errDateGe",r):this}isIban(r,t){var e=t&&t.match(/^([A-Z]{2})(\d{2})([A-Z\d]+)$/);if(!e||t.length!==IbanCodeLengths[e[1]])return this.setError("errRequired",r);var s=(e[3]+e[1]+e[2]).replace(/[A-Z]/g,r=>r.charCodeAt(0)-55).toString();let i=s.slice(0,2);for(let r=2;r<s.length;r+=7){var n=i+s.substring(r,r+7);i=parseInt(n,10)%97}return 1===i?this:this.setError("errFormat",r)}isSwift(r,t,e){return t?/^[A-Z]{6,6}[A-Z2-9][A-NP-Z0-9]([A-Z0-9]{3,3}){0,1}$/.test(t)?this:this.setError(e||"errDate",r):this.setError("errRequired",r)}getEntidades(){return BankNames}getIban1(r){return r&&r.substring(0,4)}getIban2(r){return r&&r.substring(4,8)}getEntidad(r){return BankNames[this.getIban2(r)]}getIban3(r){return r&&r.substring(8,12)}getOficina(r){return r&&r.substring(8,12)}getDC(r){return r&&r.substring(12,14)}isCreditCardNumber(r,e){if(!e||16!=e.length)return this.setError("errRequired",r);let s=0,i=!1;for(let t=15;0<=t;t--){let r=+e[t];i&&(r=(r*=2)-(9<r?9:0)),s+=r,i=!i}return s%10==0?this:this.setError("errFormat",r)}generatePassword(r,t){return t=t||"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_#@&°!§%;:=^/()?*+~.,-$",Array.apply(null,Array(r||10)).map(()=>t.charAt(Math.random()*t.length)).join("")}testPassword(r){var t=0;return t=(t=(t=(t=(t+=/[A-Z]+/.test(r)?1:0)+(/[a-z]+/.test(r)?1:0))+(/[0-9]+/.test(r)?1:0))+(/[\W]+/.test(r)?1:0))+(2<t&&8<r.length)}}