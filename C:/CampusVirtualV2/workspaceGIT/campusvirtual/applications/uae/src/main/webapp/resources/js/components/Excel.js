import coll from"./Collection.js";import i18n from"../i18n/langs.js";const isnum=e=>"number"==typeof e||e instanceof Number,isDate=e=>10==coll.size(e)||e.endsWith("T00:00:00.0Z"),isDateTime=e=>/^\d{4}-[01]\d-[0-3]\d/.test(e),fnVoid=()=>{},LETTERS=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","aW","AX","AY","AZ","BA","BB","BC","BD","BE","BF","BG","BH","BI","BJ","BK","BL","BM","BN","BO","BP","BQ","BR","BS","BT","BU","BV","BW","BX","BY","BZ","CA","CB","CC","CD","CE","CF","CG","CH","CI","CJ","CK","CL","CM","CN","CO","CP","CQ","CR","CS","CT","CU","CV","CW","CX","CY","CZ","DA","DB","DC","DD","DE","DF","DG","DH","DI","DJ","DK","DL","DM","DN","DO","DP","DQ","DR","DS","DT","DU","DV","DW","DX","DY","DZ"],HEADER_STYLES={alignment:{horizontal:"center",wrapText:!0},font:{bold:!0}};function Excel(){const s=this;this.json=(l,D)=>{(D=D||{}).titles=D.titles||[],D.columns=D.columns||{},D.file=D.file||"myFile.xlsx",D.type=D.type||"binary",D.bookType=D.bookType||"xlsx",D.cellStyles=D.cellStyles??!0;var e=XLSX.utils.book_new();e.Props={Author:D.author||"UPCT",Title:D.title||"Campus Virtual",CreatedDate:new Date};const t=D.keys||Object.keys(l[0]);var o=l.map(e=>coll.clone(e,t));const n=XLSX.utils.json_to_sheet(o);return t.forEach((e,t)=>{var o=n[LETTERS[t]+"1"];o.v=D.titles[t]||e.toUpperCase(),o.s=HEADER_STYLES,o.t="s"}),t.forEach((e,t)=>{var o=LETTERS[t],s=D.columns[e]||fnVoid;for(let e=0;e<l.length;e++){var i=n[o+(e+2)];isnum(i.v)?i.t="n":isDateTime(i.v)&&(i.v=isDate(i.v)?i18n.isoDate(i.v):i18n.isoDateTime(i.v)),s(i,l[e])}}),XLSX.utils.book_append_sheet(e,n,"Sheet1"),XLSX.writeFile(e,D.file,D),s}}export default new Excel;