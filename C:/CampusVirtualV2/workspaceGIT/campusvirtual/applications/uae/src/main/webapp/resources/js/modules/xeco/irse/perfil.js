import pf from"../../../components/Primefaces.js";import actividades from"../../../data/irse/actividades.js";import tribunales from"../../../data/irse/tribunales.js";function IrsePerfil(){const a=this,e=3,r={},n={remove:"msgDelOrg",imp:i18n.isoFloat,resp:sb.lopd,fCache:i18n.isoDate};let o,l,u,d,c,m,h;var i=new Date;function v(){return u.value=function(){let i="OTR";if(0<ab.size(m)){const t="300518";if(m.forEach(e=>{i=sb.starts(e.o,t)&&8==(8&e.mask)?"ISU":i,i=sb.starts(e.o,t)&&16==(16&e.mask)&&"ISU"!=i?"A83":i,i=(sb.starts(e.o,"300906")||sb.starts(e.o,"300920"))&&"OTR"==i?"ACA":i}),1<m.length)return"ISU"==i?"xSU":"A83"==i?"x83":"ACA"==i?"xAC":"xOT"}return i}(),dom.select(d,actividades[o.value+","+l.innerText+","+u.value]||e).select(c,a.isCom()||a.isMov()?7:1).hide(".fin-info").show(".fin-"+u.value),a}dt.addDate(i,-1),i18n.set("fCache",i.toISOString()),this.getRol=()=>o.value,this.isColaboracion=()=>"OCE"==d.value||"IAE+OCE"==d.value,this.isTribunal=()=>"ATR"==d.value||"IAE+ATR"==d.value,this.isFormacion=()=>"AFO"==d.value||"IAE+AFO"==d.value,this.isCom=()=>"COM"==d.value,this.isMun=()=>"MUN"==d.value,this.isMes=()=>"MES"==d.value,this.isIae=()=>"IAE"==d.value,this.isAtr=()=>"ATR"==d.value,this.isAfo=()=>"AFO"==d.value,this.isAcs=()=>"ACS"==d.value,this.isCtp=()=>"CTP"==d.value,this.isOce=()=>"OCE"==d.value,this.isA7j=()=>"A7J"==d.value,this.isMov=()=>"MOV"==d.value,this.is1Dia=()=>a.isMun()||a.isMes()||a.isAcs()||a.isAfo()||a.isAtr()||a.isCtp()||a.isOce(),this.isAut=()=>"AUT"==c.value,this.isAutA7j=()=>a.isAut()||a.isA7j(),this.getTribunales=()=>tribunales,this.getTribunal=e=>tribunales["at"+e]||0,this.getFinanciacion=()=>u.value,this.isIsu=()=>"ISU"==u.value||"xSU"==u.value,this.isA83=()=>"A83"==u.value||"x83"==u.value,this.isACA=()=>"ACA"==u.value||"xAC"==u.value,this.isOTR=()=>"OTR"==u.value||"xOT"==u.value,this.update=v,this.getColectivo=()=>l.innerText,this.setColectivo=e=>(l.innerText=e,a),this.getOrganicas=()=>m,this.empty=()=>ab.empty(m),this.getNumOrganicas=()=>ab.size(m),this.isMultiorganica=()=>1<ab.size(m),this.getOrganica=i=>m.find(e=>e.id==i),this.isInve3005=e=>e&&sb.starts(e.o,"3005")&&64==(64&e.mask),this.is643=e=>e&&16==(16&e.mask),this.addOrganica=()=>{h&&!m.find(e=>e.id==h.id)&&m.push(h),dom.table("#organicas",m,r,n)},this.valid=()=>(dom.closeAlerts().required("#perfil-financiacion","errPerfil"),a.empty(m)&&dom.required("#organica","errOrganicas"),dom.required("#tramitador","errPerfil").required("#interesado","errPerfil").isOk()),this.init=i=>{o=i.getInput("#rol"),l=i.querySelector("#colectivo"),u=i.getInput("#financiacion"),d=i.getInput("#actividad"),c=i.getInput("#tramite"),dom.update(),i.afterReset(()=>{m=[],i18n.set("imp",""),l.parentNode.hide(),dom.table("#organicas",m,r,n),i.querySelector(".msg-cd").hide(),v()});var e=i.setAutocomplete("#interesado",{delay:500,minLength:5,source:e=>pf.sendTerm("rcFindInteresado",e),render:e=>e.nif+" - "+e.nombre,select:e=>{var i=e.email,t=l.nextElementSibling;return dom.toggleHide(t,!i).attr(t,"href","mailto:"+i),a.setColectivo(e.ci).update(),l.parentNode.show(),e.nif},onReset:()=>l.parentNode.hide()}),t=e=>pf.sendTerm("rcFindPersonal",e);function s(){h=null,v(),i.setval("#presupuesto",JSON.stringify(m))}i.setAcItems("#promotor",t),i.setAcItems("#tribunal",t),i.setAcItems("#mesa",t),i.setAutocomplete("#organica",{minLength:4,source:e=>pf.sendTerm("rcFindOrg",e),render:e=>e.o+" - "+e.dOrg,select:e=>(h=e,i18n.set("imp",h.imp),IRSE.uxxiec||(ab.reset(m).push(m,h),s()),i.querySelector(".msg-cd").render(i18n.getCurrent()).show(),e.id),onReset:()=>{i18n.set("imp",null),i.hide(".msg-cd")}});t=(m=ab.parse(dom.getText("#org-data"))||[])[0]?.imp;return i18n.set("imp",t),dom.table("#organicas",m,r,n),dom.onRenderTable("#organicas",e=>{s(),dom.toggleHide("#add-org",m.length),i.closeAlerts().setval("#organica")}),v(),l.parentNode.setVisible(e.isLoaded()),o.addEventListener("change",v),d.addEventListener("change",v),i.querySelector(".msg-cd").render(i18n.getCurrent()).setVisible(t),a}}export default new IrsePerfil;