import coll from"../../components/Collection.js";import Form from"../../components/Form.js";import tabs from"../../components/Tabs.js";import sb from"../../components/StringBox.js";import pf from"../../components/Primefaces.js";import list from"./irse/list.js";import uxxiec from"./irse/uxxiec.js";import perfil from"./irse/perfil.js";import rutas from"./irse/rutas.js";import maps from"./irse/maps.js";import dietas from"./irse/dietas.js";import organicas from"./irse/organicas.js";import otri from"./irse/otri.js";var formIrse;pf.ready(()=>{list.init(),uxxiec.init()}),tabs.setShowEvent(3,e=>!!e.dataset.loaded||(e.dataset.loaded="1",perfil.isColaboracion()?otri.colaboracion(formIrse,e):otri.congreso(formIrse,e))),tabs.setShowEvent(2,maps),tabs.setViewEvent(5,r=>{const e=formIrse.getInput("#tipo-gasto");if(e){const s=r.querySelectorAll(".grupo-gasto"),a=()=>["201","202","204","205","206"].includes(e.value),i=()=>["301","302","303","304"].includes(e.value),n=()=>"9"==e.value,l=()=>{formIrse.setval("#tipoGasto",e.value).text("[for=txtGasto]",i18n.get("lblDescObserv")),n()?s.mask(27):a()?s.mask(21):i()?s.mask(23):"4"==e.value?(formIrse.text("[for=txtGasto]",i18n.get("lblDescTaxi")),s.mask(23)):0<+e.value?s.mask(19):s.mask(1)};rutas.update(),r.querySelectorAll(".rutas-gt-1").forEach(e=>e.classList.toggle("hide",rutas.size()<2)),dom.table("#rutas-read",rutas.getAll(),rutas.getResume(),rutas.getStyles());var t=sb.isoDate(rutas.first().dt1),o=sb.isoDate(rutas.last().dt2);s.mask(0),e.value="",e.onchange=l,formIrse.setval("#impGasto",0).setval("#txtGasto").setval("#trayectos").setval("#fAloMin",t).setAttr("#fAloMin","min",t).setAttr("#fAloMin","max",o).setval("#fAloMax",o).setAttr("#fAloMax","min",t).setAttr("#fAloMax","max",o),r.querySelector("[href='#open-file-gasto']").onclick=()=>{r.querySelector(".ui-fileupload-choose").click(),setTimeout(l,400)},document.querySelector("a#gasto-rutas").onclick=()=>{var e=document.querySelectorAll(".link-ruta:checked").map(e=>e.value).join(",");e?(formIrse.setval("#trayectos",e),r.querySelector("#uploadGasto").click()):formIrse.showError(i18n.get("errLinkRuta"))},window.fnPaso5=function(){return dom.closeAlerts(),a()?dom.required("#txtGasto","errDoc").isOk():(dom.gt0("#impGasto","errGt0","errRequired").required(e,"errTipoGasto","errRequired"),!dom.isError()&&(i()?dom.required("#txtExtra","errJustifiExtra","errRequired").isOk():"8"!=e.value||formIrse.valueOf("#trayectos")?!n()||formIrse.valueOf("#fAloMin")&&formIrse.valueOf("#fAloMax")?loading():!dom.addError("fAloMin","errFechasAloja"):!tabs.showTab(12)))}}}),tabs.setInitEvent(6,dietas.init),tabs.setViewEvent(6,e=>{dietas.render();var r=e.querySelector("#imp-gasolina-km");r&&(r.innerHTML=i18n.isoFloat(IRSE.gasolina)),e.querySelector("#imp-km").innerHTML=i18n.isoFloat(rutas.getImpKm())+" €",e.querySelector("#imp-bruto").innerHTML=i18n.isoFloat(organicas.getImpTotal())+" €",e.querySelectorAll(".rutas-vp").forEach(e=>e.classList.toggle("hide",rutas.getNumRutasVp()<1))}),tabs.setShowEvent(9,e=>{if(e.dataset.loaded)return organicas.build();function r(e){e="ES"==e;formIrse.setVisible("#entidades",!e).setVisible(".swift-block,#banco",e)}organicas.init().build();const t=formIrse.getInput("#cuentas");return formIrse.setVisible("#grupo-iban",t.options.length<=1).onChangeInput("#urgente",e=>formIrse.setVisible(".grp-urgente","2"==e.target.value)).onChangeInput("#entidades",()=>formIrse.setval("#banco",formIrse.getOptionText("#entidades"))),formIrse.onChange(t,()=>{formIrse.setval("#iban",t.value).setval("#entidades",sb.substr(t.value,4,4)).setval("#swift").setVisible("#grupo-iban",!t.value)}),dom.onChangeInput("#paises",e=>{r(e.value),formIrse.setval("#banco")}).onChangeInput("#iban",e=>{e.value=sb.toWord(e.value)}).onChangeInput("#swift",e=>{e.value=sb.toWord(e.value)}).each(t.options,e=>{var r=valid.getEntidad(e.innerText);r&&(e.innerText+=" - "+r)}),t.value||(r(formIrse.valueOf("#paises")),e.querySelector("#grupo-iban").show()),window.fnPaso9=function(){return dom.closeAlerts().required("#iban","errIban","errRequired"),t.value||("ES"!=formIrse.valueOf("#paises")?dom.required("#swift","errSwift","errRequired").required("#banco",null,"errRequired"):dom.required("#entidades",null,"errRequired")),"2"==formIrse.valueOf("#urgente")&&dom.required("#extra","errExtra","errRequired").geToday("#fMax","errFechaMax","errRequired"),dom.isOk()&&organicas.build()&&loading()},window.fnSend=()=>i18n.confirm("msgFirmarEnviar"),e.dataset.loaded="1",!0}),tabs.setShowEvent("uxxiec",uxxiec.load),window.fnUnlink=()=>i18n.confirm("msgUnlink")&&loading(),window.fnClone=()=>i18n.confirm("msgReactivar")&&loading(),window.saveTab=()=>dom.showOk(i18n.get("saveOk")).working(),window.showAlerts=pf.showAlerts,window.showNextTab=window.showTab,window.viewTab=tabs.showTab,window.viewIrse=(e,r,t,o)=>{pf.isLoaded(e,r,t)&&(tabs.load(document),Object.assign(IRSE,coll.parse(t.data)),(formIrse=new Form("#xeco-irse")).disabled(!0,".ui-state-disabled"),perfil.init(formIrse),rutas.init(formIrse),dom.tr(".i18n-tr-h1"),o=o??IRSE.tab,globalThis.isset(o)?tabs.showTab(o):tabs.nextTab(),pf.showAlerts(e,r,t))},window.ip=perfil,window.ir=rutas,window.io=organicas;