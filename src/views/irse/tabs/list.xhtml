<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:p="http://primefaces.org/ui" 
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:c="http://java.sun.com/jsp/jstl/core">

	<h2><h:outputText value="#{msg['uae.irse.index.msg.list']}" escape="false" /></h2>
	<h:form id="xeco-filtro" prependId="false" class="card-filter" onsubmit="loading();">
		<div class="ui-blocks">
			<label class="ui-block">
				<div class="label"><h:outputText value="#{msg['lbl.ejercicio']}" escape="false" />:</div>
				<h:selectOneMenu value="#{iris.input.ejercicio}" styleClass="ui-input ui-select ui-filter" tabindex="1" title="#{msg['tit.ejercicio']}">
					<f:selectItems value="#{iris.input.ejercicios}" />
				</h:selectOneMenu>
			</label>
			<label class="ui-block">
				<div class="label"><h:outputText value="#{msg['lbl.estado']}" escape="false" />:</div>
				<h:selectOneMenu id="estado" value="#{iris.input.estado}" styleClass="ui-input ui-select ui-filter" tabindex="2" title="#{msg['tit.estado']}">
					<f:selectItem itemValue="" itemLabel="" />
					<f:selectItem itemValue="6" itemLabel="#{msg['uae.irse.filter.estado.6']}" itemEscaped="false"/>
					<f:selectItem itemValue="5" itemLabel="#{msg['uae.irse.filter.estado.5']}" itemEscaped="false"/>
					<f:selectItem itemValue="1" itemLabel="#{msg['uae.irse.filter.estado.1']}" itemEscaped="false"/>
					<f:selectItem itemValue="2" itemLabel="#{msg['uae.irse.filter.estado.2']}" itemEscaped="false"/>
					<f:selectItem itemValue="4" itemLabel="#{msg['uae.irse.filter.estado.4']}" itemEscaped="false"/>
					<f:selectItem itemValue="7" itemLabel="#{msg['uae.irse.filter.estado.7']}" itemEscaped="false"/>
					<f:selectItem itemValue="8" itemLabel="#{msg['uae.irse.filter.estado.8']}" itemEscaped="false"/>
				</h:selectOneMenu>
			</label>
			<label class="ui-block">
				<div class="label"><h:outputText value="#{msg['lbl.mi.firma']}" escape="false" />:</div>
				<h:selectOneMenu id="firma" value="#{iris.input.firma}" styleClass="ui-input ui-select ui-filter" tabindex="3" title="#{msg['lbl.mi.firma']}">
					<f:selectItem itemValue="" itemLabel="" />
					<f:selectItem itemValue="5" itemLabel="#{iris.getMsg('lblPendiente')}" />
					<f:selectItem itemValue="1" itemLabel="#{iris.getMsg('lblAceptada')}" />
					<f:selectItem itemValue="2" itemLabel="#{iris.getMsg('lblRechazada')}" />
				</h:selectOneMenu>
			</label>
			<label class="ui-block">
				<div class="label"><h:outputText value="#{msg['lbl.codigo']}" escape="false" />:</div>
				<h:inputText value="#{iris.input.codigo}" styleClass="ui-input ui-code ui-filter" tabindex="4" />
			</label>
			<label class="ui-block">
				<div class="label"><h:outputText value="#{msg['lbl.presupuesto']}" escape="false" />:</div>
				<h:inputText value="#{iris.input.organica}" styleClass="ui-input ui-code ui-filter" tabindex="5" />
			</label>
			<label class="ui-block">
				<div class="label"><h:outputText value="#{msg['lbl.fecha.creacion']}" escape="false" />:</div>
				<h:inputText id="f-min" value="#{iris.input.FMin}" tabindex="6" styleClass="ui-input ui-date ui-filter"/> ...
				<h:inputText id="f-max" value="#{iris.input.FMax}" tabindex="7" styleClass="ui-input ui-date ui-filter"/>
			</label>
		</div>

		<div class="ui-blocks">
			<div class="ui-block-row">
				<a id="filtro" href="#tab-toggle" data-toggle="fa-angle-double-down fa-angle-double-up"><h:outputText value="#{msg['uae.irse.filter.lbl.extra']}" escape="false" /><i class="fas fa-angle-double-down icon"></i></a>
			</div>
			<label class="ui-block info-filtro hide">
				<div class="label"><h:outputText value="#{msg['uae.irse.tab0.lbl.int']}" escape="false" />:</div>
				<h:inputText value="#{iris.input.interesado}" styleClass="ui-input ui-text ui-filter" tabindex="8" />
			</label>
			<label class="ui-block info-filtro hide">
				<div class="label"><h:outputText value="#{msg['uae.irse.tab0.lbl.act.a']}" escape="false" /></div>
				<h:selectOneMenu id="filtro-actividad" value="#{iris.input.actividad}" class="ui-input ui-select ui-filter" tabindex="10">
					<f:selectItem itemValue="" itemLabel="" />
					<f:selectItem itemValue="COM" itemLabel="#{msg['uae.irse.tab0.act.com']}" itemEscaped="false"/>
					<f:selectItem itemValue="MUN" itemLabel="#{msg['uae.irse.tab0.act.mun']}" itemEscaped="false"/>
					<f:selectItem itemValue="MES" itemLabel="#{msg['uae.irse.tab0.act.mes']}" itemEscaped="false"/>
					<f:selectItem itemValue="IAE" itemLabel="#{msg['uae.irse.tab0.act.iae']}" itemEscaped="false"/>
					<f:selectItem itemValue="ATR" itemLabel="#{msg['uae.irse.tab0.act.atr']}" itemEscaped="false"/>
					<f:selectItem itemValue="IAE+ATR" itemLabel="#{msg['uae.irse.tab0.act.iae.atr']}" itemEscaped="false"/>
					<f:selectItem itemValue="AFO" itemLabel="#{msg['uae.irse.tab0.act.afo']}" itemEscaped="false"/>
					<f:selectItem itemValue="IAE+AFO" itemLabel="#{msg['uae.irse.tab0.act.iae.afo']}" itemEscaped="false"/>
					<f:selectItem itemValue="ACS" itemLabel="#{msg['uae.irse.tab0.act.acs']}" itemEscaped="false"/>
					<f:selectItem itemValue="OCE" itemLabel="#{msg['uae.irse.tab0.act.col']}" itemEscaped="false"/>
					<f:selectItem itemValue="IAE+OCE" itemLabel="#{msg['uae.irse.tab0.act.iae.col']}" itemEscaped="false"/>
					<f:selectItem itemValue="A7J" itemLabel="#{msg['uae.irse.tab0.act.a7j']}" itemEscaped="false"/>
					<f:selectItem itemValue="MOV" itemLabel="#{msg['uae.irse.tab0.act.mov']}" itemEscaped="false"/>
				</h:selectOneMenu>
			</label>
			<label class="ui-block info-filtro hide">
				<div class="label"><h:outputText value="#{msg['uae.irse.tab0.lbl.tramite']}" escape="false" /></div>
				<h:selectOneMenu id="filtro-tramite" value="#{iris.input.tramite}" class="ui-input ui-select ui-filter" tabindex="11">
					<f:selectItem itemValue="" itemLabel="" />
					<f:selectItem itemValue="AUT" itemLabel="#{msg['uae.irse.tab0.tramit.aut']}" itemEscaped="false"/>
					<f:selectItem itemValue="LIQ" itemLabel="#{msg['uae.irse.tab0.tramit.liq']}" itemEscaped="false"/>
					<f:selectItem itemValue="AyL" itemLabel="#{msg['uae.irse.tab0.tramit.ayl']}" itemEscaped="false"/>
				</h:selectOneMenu>
			</label>
		</div>

		<div class="navbar">
			<a href="#tab-13" class="btn btn-info" title="#{msg['tit.btn.volver.ini']}" tabindex="12">
				<i class="fas fa-caret-left btn-icon-left"></i><h:outputText value="#{msg['lbl.btn.volver']}" escape="false" /></a>
			<p:commandButton id="filter-list" action="#{iris.list.list()}" onclick="loading();" update="xeco-list" oncomplete="showNextTab(xhr, status, args, 14);"
					icon="far fa-search" styleClass="btn btn-info" value="Buscar" tabindex="13"></p:commandButton>
			<p:commandLink action="#{iris.list.list()}" onclick="onList();" update="xeco-list" oncomplete="working();" 
					styleClass="btn btn-warn warning-btn" tabindex="14">
				<i class="ui-button-icon-left ui-icon ui-c far fa-times-circle"></i><span class="ui-button-text ui-c">Limpiar</span>
			</p:commandLink>
		</div>
	</h:form>

	<br class="clear"/>
	<h:form id="xeco-list" prependId="false" onsubmit="loading();">
	<table id="solicitudes" class="tb-xeco">
		<thead>
			<tr>
				<th></th>
				<th><h:outputText value="#{msg['lbl.codigo']}" escape="false" /></th>
				<th><h:outputText value="#{msg['lbl.estado']}" escape="false" /></th>
				<th><h:outputText value="#{msg['lbl.mi.firma']}" escape="false" /></th>
				<th><span class="hide-sm"><h:outputText value="#{msg['lbl.sig.firma']}" escape="false" /></span></th>
				<th class="hide-xs"><h:outputText value="#{msg['lbl.fecha.creacion']}" escape="false" /></th>
				<th><h:outputText value="#{msg['lbl.presupuesto']}" escape="false" /></th>
				<th><h:outputText value="#{msg['uae.irse.tab0.lbl.int']}" escape="false" /></th>
				<th><span class="hide-sm"><h:outputText value="#{msg['lbl.objeto.act']}" escape="false" /></span></th>
				<th><h:outputText value="#{msg['lbl.imp.liq']}" escape="false" /></th>
				<th><h:outputText value="#{msg['lbl.acciones']}" escape="false" /></th>
			</tr>
		</thead>
		<tbody>
			<c:if test="#{empty iris.solicitudes}">
				<tr><td class="no-data" colspan="99">No se han encontrado comunicaciones asociadas al filtro seleccionado</td></tr>
			</c:if>
			<c:forEach items="#{iris.solicitudes}" var="sol">
			<tr id="#{sol.idIrse}" class="tb-data">
				<td class="text-center text-red text-xl">
					<c:if test="#{sol.urgente}">
						<c:choose>
							<c:when test="#{iris.uae}">
								<span class="texterr textbig textuc" title="#{iris.list.getMsgUrgencia(sol)}">&#33;</span>
							</c:when>
							<c:otherwise>
								<span class="texterr textbig textuc" title="#{iris.list.getMsgUrgenciaShort(sol)}">&#33;</span>
							</c:otherwise>
						</c:choose>
					</c:if>
				</td>
				<td>
					<p:commandLink action="#{iris.list.view(sol)}" onclick="loading();" update="@(.update-irse)" oncomplete="viewIrse(xhr, status, args)"
							title="#{sol.codigo}: #{sol.fullName}">#{sol.codigoNum}</p:commandLink>
				</td>
				<td>
					<c:choose>
						<c:when test="#{sol.editable}">
							<span class="estado text-warn"><h:outputText value="#{msg['uae.irse.list.estado.6']}" escape="false" /></span>
						</c:when>
						<c:when test="#{sol.aceptada}">
							<span class="estado text-green"><h:outputText value="#{msg['uae.irse.list.estado.1']}" escape="false" /></span>
						</c:when>
						<c:when test="#{sol.rechazada}">
							<span class="estado text-error"><h:outputText value="#{msg['uae.irse.list.estado.2']}" escape="false" /></span>
						</c:when>
						<c:when test="#{sol.ejecutada}">
							<span class="estado text-green"><h:outputText value="#{msg['uae.irse.list.estado.3']}" escape="false" /></span>
						</c:when>
						<c:when test="#{sol.notificada}">
							<span class="estado text-green"><h:outputText value="#{msg['uae.irse.list.estado.4']}" escape="false" /></span>
						</c:when>
						<c:when test="#{sol.cancelada}">
							<span class="estado text-error"><h:outputText value="#{msg['uae.irse.list.estado.7']}" escape="false" /></span>
						</c:when>
						<c:when test="#{sol.caducada}">
							<span class="estado text-error"><h:outputText value="#{msg['uae.irse.list.estado.8']}" escape="false" /></span>
						</c:when>
						<c:otherwise>
							<span class="estado text-warn"><h:outputText value="#{msg['uae.irse.list.estado.5']}" escape="false" /></span>
						</c:otherwise>
					</c:choose>
				</td>
				<td class="text-center">
					<c:choose>
						<c:when test="#{sol.firmaAceptada}">
							<i class="fas fa-flag fa-lg text-green" title="Solicitud firmada"></i>
						</c:when>
						<c:when test="#{sol.firmaRechazada or sol.cancelada}">
							<i class="fas fa-flag fa-lg text-error" title="Solicitud rechazada"></i>
						</c:when>
						<c:otherwise>
							<i class="fas fa-flag fa-lg text-warn" title="Solicitud pendiente de firma"></i>
						</c:otherwise>
					</c:choose>
				</td>
				<td><span class="hide-sm">#{sol.sigFirma}</span></td>
				<td class="hide-xs">#{iris.list.getFCreacion(sol)}</td>
				<td>#{sol.organica}<span class="hide-sm"> #{sol.descOrganica}</span><c:if test="#{sol.multipartida}"><span> (y otras)</span></c:if></td>
				<td>#{sol.fullNameInteresado}</td>
				<td><span class="hide-sm">#{sol.memoria}</span></td>
				<td class="text-right">#{iris.list.getImporte(sol)} €</td>
				<td class="text-right">
					<p:commandLink action="#{iris.list.view(sol)}" onclick="loading();" update="@(.update-irse)" oncomplete="viewIrse(xhr, status, args)" title="Acceso a la comunicación">
							<i class="fas fa-search action text-blue resize"></i></p:commandLink>
					<c:if test="#{sol.editable and iris.uae}">
						<p:commandLink action="#{iris.list.activePaso8(sol)}" onclick="loading();" oncomplete="showAlerts(xhr, status, args)" 
							title="Activar Otras Indemnizaciones Extraordinarias (paso 8)"><i class="fas fa-plus action text-green resize"></i></p:commandLink>
					</c:if>
					<c:if test="#{sol.reactivable}">
						<p:commandLink action="#{iris.list.clone(sol)}" onclick="if (!fnClone()) return false;" update="@(.update-irse)" oncomplete="viewIrse(xhr, status, args, 0)"
								title="Subsanar la comunicación salvo cambio de presupuesto">
							<i class="far fa-edit action text-blue resize"></i></p:commandLink>
					</c:if>
					<c:if test="#{sol.firmable}">
						<p:commandLink action="#{iris.list.firmar(sol)}" onclick="if (!fnFirmar()) return false;loading();" update="xeco-list" oncomplete="showAlerts(xhr, status, args)" title="Firmar rolicitud"><i class="fas fa-check action text-green resize"></i></p:commandLink>
						<p:commandLink action="#{iris.list.confirm(sol)}" onclick="loading();" update="@(.update-irse)" oncomplete="viewIrse(xhr, status, args, 'reject');" title="Ir al motivo de rechazo"><i class="fas fa-times action text-red resize"></i></p:commandLink>
					</c:if>
					<c:if test="#{sol.ejecutable}">
						<p:commandLink action="#{iris.list.report(sol)}" onclick="loading();" oncomplete="handleReport(xhr, status, args)" title="#{msg['tit.btn.informe']}">
							<i class="fal fa-file-pdf action text-red resize"></i></p:commandLink>
					</c:if>
					<c:if test="#{iris.admin and iris.isIntegrable(sol)}">
						<p:commandLink action="#{iris.list.rptFinalizar(sol)}" onclick="loading();" oncomplete="openHtml(xhr, status, args, 'Informe IRIS')" title="Consulta los datos de la solicitud"><i class="fas fa-clipboard-list action text-blue resize"></i></p:commandLink>
						<p:commandLink action="#{iris.list.integrar(sol)}" onclick="if(!fnIntegrar(this)) return false;" oncomplete="showAlerts(xhr, status, args)" title="Lanza el proceso de integración con la capa SOA"><i class="far fa-save action resize text-blue"></i></p:commandLink>
					</c:if>
					<c:if test="#{iris.isEjecutable(sol) and (iris.isUae() or sol.isFirmaGestor())}">
						<p:commandLink action="#{iris.list.uxxi(sol)}" update="@(.update-irse)" oncomplete="viewIrse(xhr, status, args, 'uxxiec');" title="Expediente asociado a la solicitud"><i class="fal fa-cog action text-blue resize"></i></p:commandLink>
					</c:if>
					<c:if test="#{iris.admin}">
						<p:commandLink action="#{iris.list.emails(sol)}" onclick="loading();" oncomplete="showAlerts(xhr, status, args)" title="Envia una prueba de cada tipo de correo al administrador"><i class="fal fa-mail-bulk action text-blue resize"></i></p:commandLink>
						<p:commandLink action="#{iris.list.recalc(sol)}" onclick="if (!fnFirmar()) return false;loading();" update="xeco-list" oncomplete="showAlerts(xhr, status, args)" title="Recalcula las firmas asociadas a la comunicación"><i class="far fa-file-signature action text-green resize"></i></p:commandLink>
					</c:if>
					<c:if test="#{iris.form.isRemovable(sol)}">
						<p:commandLink action="#{iris.list.remove(sol.idIrse)}" onclick="if (!fnRemove()) return false;" update="xeco-list" oncomplete="showAlerts(xhr, status, args)" title="Borra la comunicación del sistema"><i class="fal fa-trash-alt action text-red resize"></i></p:commandLink>
					</c:if>
				</td>
			</tr>
			</c:forEach>
		</tbody>
		<tfoot>
			<tr><td colspan="11"><h:outputText value="#{msg['lbl.filas']}" escape="false" />: #{iris.numSolicitudes}</td></tr>
		</tfoot>
	</table>
	</h:form>

	<a href="#tab-13" class="btn btn-info" title="#{msg['tit.btn.volver.ini']}" tabindex="100">
		<i class="fas fa-caret-left btn-icon-left"></i><h:outputText value="#{msg['lbl.btn.volver']}" escape="false" /></a>
</html>
